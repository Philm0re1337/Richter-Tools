<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REWE Richter - Personal-Kosten-Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #121212;
            color: #e5e7eb;
        }
        .card { 
            background: #1e1e1e; 
            border-radius: 12px; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            border: 1px solid #2d2d2d;
        }
        input, select {
            background-color: #2d2d2d !important;
            border-color: #404040 !important;
            color: #ffffff !important;
        }
        input:focus, select:focus {
            border-color: #dc2626 !important;
            ring-color: #dc2626 !important;
        }
        .rewe-red { color: #cc071e; }
        .bg-rewe-red { background-color: #cc071e; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #121212; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem;
            border-radius: 8px;
            background: #1e1e1e;
            border-left: 4px solid #cc071e;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            transform: translateY(150%);
            transition: transform 0.3s ease;
            z-index: 50;
        }
        .notification.show {
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 text-gray-200">

    <div id="toast" class="notification">
        <p id="toast-message" class="text-sm font-medium"></p>
    </div>

    <div class="max-w-6xl mx-auto">
        <header class="mb-8 flex flex-col md:flex-row justify-between items-center border-b border-gray-800 pb-6 gap-6">
            <div class="flex items-center gap-4">
                <div class="bg-white p-2 rounded-lg shadow-lg flex flex-col items-center justify-center w-24 h-24 border-2 border-[#cc071e]">
                    <span class="text-[#cc071e] font-black text-xl leading-none">REWE</span>
                    <span class="text-black font-bold text-xs mt-1 uppercase tracking-tighter">Richter</span>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-white uppercase tracking-tight">Personal-Kosten</h1>
                    <p class="text-gray-400 text-sm">Controlling & Analyse Management</p>
                </div>
            </div>
            
            <div class="flex flex-col items-center md:items-end gap-3">
                <div class="flex flex-col md:flex-row gap-3">
                    <div class="text-center md:text-right bg-[#1e1e1e] p-4 rounded-xl border border-gray-800 shadow-inner min-w-[180px]">
                        <div id="total-cost-display" class="text-3xl font-bold text-[#cc071e]">0,00 €</div>
                        <p class="text-[10px] font-semibold text-gray-500 uppercase tracking-widest mt-1">Gesamtkosten (AG)</p>
                    </div>
                    <div class="text-center md:text-right bg-[#1e1e1e] p-4 rounded-xl border border-gray-800 shadow-inner min-w-[150px]">
                        <div id="quote-display" class="text-3xl font-bold text-blue-400">0,0 %</div>
                        <p class="text-[10px] font-semibold text-gray-500 uppercase tracking-widest mt-1">PK-Quote</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportData()" class="text-[10px] bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded border border-gray-700 transition">Daten Exportieren</button>
                    <button onclick="resetToDefault()" class="text-[10px] bg-gray-800 hover:bg-red-900/40 px-3 py-1 rounded border border-gray-700 transition text-gray-400">Zurücksetzen</button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-6">
                <div class="card p-6 border-l-4 border-blue-500">
                    <h2 class="text-sm font-bold mb-4 text-white uppercase tracking-wider">Plan-Umsatz Monat</h2>
                    <div>
                        <label class="block text-[10px] font-medium text-gray-400 uppercase mb-1">Geplanter Umsatz (€)</label>
                        <input type="number" id="planned-revenue" value="0" oninput="updateUI()" class="block w-full rounded-md shadow-sm p-3 text-lg font-bold outline-none transition-all border border-gray-700">
                        <p class="text-[10px] text-gray-500 mt-2 italic">Änderungen wirken sich sofort auf die PK-Quote aus.</p>
                    </div>
                </div>

                <div class="card p-6">
                    <h2 id="form-title" class="text-xl font-semibold mb-6 text-white border-l-4 border-[#cc071e] pl-3">Mitarbeiter hinzufügen</h2>
                    <form id="employee-form" class="space-y-4">
                        <input type="hidden" id="edit-id">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-400 uppercase mb-1">Vorname</label>
                                <input type="text" id="firstName" required class="block w-full rounded-md shadow-sm p-2 outline-none transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-400 uppercase mb-1">Nachname</label>
                                <input type="text" id="lastName" required class="block w-full rounded-md shadow-sm p-2 outline-none transition-all">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-400 uppercase mb-1">Stundenlohn (€)</label>
                                <input type="number" id="hourly-rate" step="0.01" required class="block w-full rounded-md shadow-sm p-2 outline-none transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-400 uppercase mb-1">Durchschn. Std.</label>
                                <input type="number" id="hours-per-month" step="0.01" required class="block w-full rounded-md shadow-sm p-2 outline-none transition-all">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-400 uppercase mb-1">Personal-Nr.</label>
                                <input type="number" id="p-number" class="block w-full rounded-md shadow-sm p-2 outline-none transition-all">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-400 uppercase mb-1">SV-Anteil (%)</label>
                                <input type="number" id="ancillary-costs" value="21" step="0.1" class="block w-full rounded-md shadow-sm p-2 outline-none transition-all">
                            </div>
                        </div>
                        <div class="flex flex-col gap-3 mt-6">
                            <button type="submit" id="submit-btn" class="w-full bg-[#cc071e] text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition duration-200 shadow-lg shadow-red-900/40">
                                Hinzufügen
                            </button>
                            <button type="button" id="cancel-btn" class="hidden w-full bg-gray-800 text-gray-300 font-bold py-3 px-4 rounded-lg hover:bg-gray-700 transition duration-200">
                                Abbrechen
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="card overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-800">
                            <thead class="bg-[#252525]">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Mitarbeiter</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Basis</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Brutto (AN)</th>
                                    <th class="px-6 py-4 text-left text-xs font-bold text-red-500 uppercase tracking-wider">AG-Gesamt</th>
                                    <th class="px-6 py-4 text-right text-xs font-bold text-gray-400 uppercase tracking-wider">Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="employee-list" class="divide-y divide-gray-800"></tbody>
                        </table>
                    </div>
                    <div id="empty-state" class="p-16 text-center text-gray-600 italic">
                        Keine Mitarbeiter in der Datenbank vorhanden.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const defaultEmployees = [
            { id: 2, firstName: "Kornelia", lastName: "König", hourlyRate: 13.90, hours: 43.00, ancillaryPercent: 30.0 },
            { id: 3, firstName: "Heike", lastName: "Darras", hourlyRate: 15.50, hours: 182.36, ancillaryPercent: 21.0 },
            { id: 4, firstName: "Elke", lastName: "Wagner", hourlyRate: 13.90, hours: 130.00, ancillaryPercent: 21.0 },
            { id: 5, firstName: "Sabine", lastName: "Pietzka", hourlyRate: 13.90, hours: 151.50, ancillaryPercent: 21.0 },
            { id: 7, firstName: "Birgit", lastName: "Siebert", hourlyRate: 13.90, hours: 130.00, ancillaryPercent: 21.0 },
            { id: 9, firstName: "Sabine", lastName: "Nejedli", hourlyRate: 13.90, hours: 91.63, ancillaryPercent: 21.0 },
            { id: 10, firstName: "Carina", lastName: "Hemminghaus", hourlyRate: 13.90, hours: 0.00, ancillaryPercent: 21.0 },
            { id: 15, firstName: "Bianca", lastName: "Dams", hourlyRate: 13.90, hours: 0.00, ancillaryPercent: 21.0 },
            { id: 16, firstName: "Doris", lastName: "Valenti", hourlyRate: 13.90, hours: 151.55, ancillaryPercent: 21.0 },
            { id: 17, firstName: "Songül", lastName: "Inal", hourlyRate: 13.90, hours: 43.00, ancillaryPercent: 30.0 },
            { id: 18, firstName: "Tülay", lastName: "Sarikaya", hourlyRate: 14.00, hours: 167.55, ancillaryPercent: 21.0 },
            { id: 21, firstName: "Ceylan", lastName: "Özyer", hourlyRate: 14.42, hours: 173.33, ancillaryPercent: 21.0 },
            { id: 23, firstName: "Melanie", lastName: "Halbhuber", hourlyRate: 14.00, hours: 130.00, ancillaryPercent: 21.0 },
            { id: 24, firstName: "Acelga", lastName: "Demirci", hourlyRate: 13.90, hours: 104.00, ancillaryPercent: 21.0 },
            { id: 26, firstName: "Rene", lastName: "Neumann", hourlyRate: 13.90, hours: 173.33, ancillaryPercent: 21.0 },
            { id: 27, firstName: "Ingrid", lastName: "Selke", hourlyRate: 13.90, hours: 104.00, ancillaryPercent: 21.0 },
            { id: 30, firstName: "Elke", lastName: "Christie", hourlyRate: 15.00, hours: 173.33, ancillaryPercent: 21.0 },
            { id: 31, firstName: "Rukiye", lastName: "Bagci", hourlyRate: 13.90, hours: 158.42, ancillaryPercent: 21.0 },
            { id: 32, firstName: "Corina", lastName: "Flug", hourlyRate: 13.90, hours: 173.33, ancillaryPercent: 21.0 },
            { id: 34, firstName: "Tea", lastName: "Richter", hourlyRate: 20.19, hours: 147.65, ancillaryPercent: 21.0 },
            { id: 35, firstName: "Samantha", lastName: "Christie", hourlyRate: 13.90, hours: 169.72, ancillaryPercent: 21.0 },
            { id: 38, firstName: "Dieter", lastName: "Kradjel", hourlyRate: 13.90, hours: 97.38, ancillaryPercent: 21.0 },
            { id: 40, firstName: "Alexander", lastName: "Bünger", hourlyRate: 13.90, hours: 129.17, ancillaryPercent: 21.0 },
            { id: 42, firstName: "Oxana", lastName: "Morawiec", hourlyRate: 13.90, hours: 43.00, ancillaryPercent: 30.0 },
            { id: 43, firstName: "Nils", lastName: "Drechsler", hourlyRate: 20.52, hours: 195.00, ancillaryPercent: 21.0 },
            { id: 48, firstName: "Justin", lastName: "Scheidler", hourlyRate: 13.90, hours: 173.00, ancillaryPercent: 21.0 },
            { id: 49, firstName: "Florian", lastName: "Maire", hourlyRate: 7.51, hours: 162.50, ancillaryPercent: 21.0 },
            { id: 51, firstName: "Ricardo", lastName: "Rubarth", hourlyRate: 23.08, hours: 173.33, ancillaryPercent: 21.0 },
            { id: 52, firstName: "Shui-Chen", lastName: "Wong-Qi", hourlyRate: 18.00, hours: 130.00, ancillaryPercent: 21.0 },
            { id: 53, firstName: "Jessica", lastName: "Kicker", hourlyRate: 16.92, hours: 95.65, ancillaryPercent: 21.0 },
            { id: 54, firstName: "Can Kubilay", lastName: "Koc", hourlyRate: 7.51, hours: 159.38, ancillaryPercent: 21.0 },
            { id: 57, firstName: "Simone", lastName: "Schmidt", hourlyRate: 16.00, hours: 130.00, ancillaryPercent: 21.0 },
            { id: 60, firstName: "Michael", lastName: "Scholz", hourlyRate: 14.05, hours: 162.00, ancillaryPercent: 21.0 },
            { id: 65, firstName: "Maximilian", lastName: "da Silva Goncalves", hourlyRate: 14.00, hours: 173.33, ancillaryPercent: 21.0 },
            { id: 63, firstName: "Regina", lastName: "Hinrichsen", hourlyRate: 15.50, hours: 130.00, ancillaryPercent: 21.0 },
            { id: 64, firstName: "Andreas", lastName: "Malyszka", hourlyRate: 16.00, hours: 163.00, ancillaryPercent: 21.0 }
        ];

        let employees = [];
        let isEditing = false;

        const form = document.getElementById('employee-form');
        const list = document.getElementById('employee-list');
        const emptyState = document.getElementById('empty-state');
        const totalDisplay = document.getElementById('total-cost-display');
        const quoteDisplay = document.getElementById('quote-display');
        const revenueInput = document.getElementById('planned-revenue');
        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const editIdInput = document.getElementById('edit-id');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');

        window.onload = () => {
            loadFromStorage();
            updateUI();
        };

        function showToast(message) {
            toastMessage.innerText = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function saveToStorage() {
            localStorage.setItem('rewe_richter_employees', JSON.stringify(employees));
            localStorage.setItem('rewe_richter_revenue', revenueInput.value);
        }

        function loadFromStorage() {
            const stored = localStorage.getItem('rewe_richter_employees');
            const storedRev = localStorage.getItem('rewe_richter_revenue');
            if (stored) employees = JSON.parse(stored);
            else {
                employees = [...defaultEmployees];
                saveToStorage();
            }
            if (storedRev) revenueInput.value = storedRev;
        }

        function resetToDefault() {
            if (confirm('Daten zurücksetzen?')) {
                employees = [...defaultEmployees];
                revenueInput.value = 0;
                saveToStorage();
                updateUI();
                showToast('Daten zurückgesetzt');
            }
        }

        function exportData() {
            const exportObj = { employees, plannedRevenue: revenueInput.value };
            const dataStr = JSON.stringify(exportObj, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `personalkosten_export_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showToast('Daten exportiert');
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const pNum = parseInt(document.getElementById('p-number').value);
            const employeeData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                hourlyRate: parseFloat(document.getElementById('hourly-rate').value),
                hours: parseFloat(document.getElementById('hours-per-month').value),
                ancillaryPercent: parseFloat(document.getElementById('ancillary-costs').value) || 21
            };

            if (isEditing) {
                const id = parseInt(editIdInput.value);
                const index = employees.findIndex(emp => emp.id === id);
                if (index !== -1) employees[index] = { ...employees[index], ...employeeData };
                resetForm();
            } else {
                employees.push({ id: pNum || Date.now(), ...employeeData });
            }

            saveToStorage();
            updateUI();
            form.reset();
            document.getElementById('ancillary-costs').value = 21;
        });

        function editEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;
            isEditing = true;
            formTitle.innerText = "Mitarbeiter bearbeiten";
            submitBtn.innerText = "Speichern";
            cancelBtn.classList.remove('hidden');
            editIdInput.value = emp.id;
            document.getElementById('firstName').value = emp.firstName;
            document.getElementById('lastName').value = emp.lastName;
            document.getElementById('hourly-rate').value = emp.hourlyRate;
            document.getElementById('hours-per-month').value = emp.hours;
            document.getElementById('p-number').value = emp.id;
            document.getElementById('ancillary-costs').value = emp.ancillaryPercent;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteEmployee(id) {
            if (confirm('Löschen?')) {
                employees = employees.filter(emp => emp.id !== id);
                saveToStorage();
                updateUI();
                showToast('Mitarbeiter gelöscht');
            }
        }

        function formatEuro(amount) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(amount);
        }

        function updateUI() {
            employees.sort((a, b) => a.lastName.localeCompare(b.lastName));
            list.innerHTML = '';
            let totalCompanyCost = 0;

            if (employees.length === 0) emptyState.classList.remove('hidden');
            else emptyState.classList.add('hidden');

            employees.forEach(emp => {
                const grossSalary = emp.hourlyRate * emp.hours;
                const companyCost = grossSalary * (1 + (emp.ancillaryPercent / 100));
                totalCompanyCost += companyCost;

                const row = document.createElement('tr');
                row.className = 'hover:bg-[#252525] transition-colors group';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-semibold text-white">${emp.lastName}, ${emp.firstName}</div>
                        <div class="text-[10px] text-gray-500">Pers.-Nr. ${emp.id}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                        ${emp.hours.toFixed(2)}h à ${formatEuro(emp.hourlyRate)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${formatEuro(grossSalary)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-bold text-red-500">${formatEuro(companyCost)}</div>
                        <div class="text-[9px] text-gray-600">${emp.ancillaryPercent}% SV</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex justify-end gap-2">
                            <button onclick="editEmployee(${emp.id})" class="text-gray-400 hover:text-white bg-gray-800 p-2 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg></button>
                            <button onclick="deleteEmployee(${emp.id})" class="text-gray-400 hover:text-red-500 bg-gray-800 p-2 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>
                        </div>
                    </td>
                `;
                list.appendChild(row);
            });

            totalDisplay.innerText = formatEuro(totalCompanyCost);
            
            // Quote Berechnung
            const revenue = parseFloat(revenueInput.value) || 0;
            if (revenue > 0) {
                const quote = (totalCompanyCost / revenue) * 100;
                quoteDisplay.innerText = quote.toFixed(1) + " %";
                // Farbliche Warnung bei hoher Quote (Beispiel: > 18%)
                quoteDisplay.className = quote > 18 ? "text-3xl font-bold text-orange-500" : "text-3xl font-bold text-blue-400";
            } else {
                quoteDisplay.innerText = "0,0 %";
                quoteDisplay.className = "text-3xl font-bold text-blue-400";
            }
            saveToStorage();
        }

        function resetForm() {
            isEditing = false;
            formTitle.innerText = "Mitarbeiter hinzufügen";
            submitBtn.innerText = "Hinzufügen";
            cancelBtn.classList.add('hidden');
            editIdInput.value = "";
        }
    </script>
</body>
</html>